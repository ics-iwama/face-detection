(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))e(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&e(r)}).observe(document,{childList:!0,subtree:!0});function n(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function e(a){if(a.ep)return;a.ep=!0;const s=n(a);fetch(a.href,s)}})();let M,E,L=["hige","ribbon","rabbit","cat02","cat03","bear01"],f={},W=document.querySelectorAll(".button"),X=document.querySelectorAll(".position-controllerButton"),h,v=0,j=0;const u=document.getElementById("webcam"),m=document.getElementById("canvas"),I=document.getElementById("canvasWrapper"),d=m.getContext("2d");function F(){W.forEach(o=>{o.addEventListener("click",t=>{v=0,j=0,h=t.target.dataset.deco||t.target.parentElement.dataset.deco})}),X.forEach(o=>{o.addEventListener("click",t=>{const n=t.target.dataset.position||t.target.parentElement.dataset.position;n==="top"?j+=5:n==="bottom"?j-=5:n==="right"?v+=5:n==="left"&&(v-=5)})})}async function P(){const o={audio:!1,video:!0,width:640,height:480};try{const t=await navigator.mediaDevices.getUserMedia(o);return u.srcObject=t,new Promise(n=>{u.onloadedmetadata=()=>{u.play(),n()}})}catch(t){console.error("Error accessing webcam: ",t),alert("カメラのアクセスに失敗しました。カメラのアクセス権限を確認してください。")}}function Y(){m.width=u.videoWidth,m.height=u.videoHeight,I.style.width=`${u.videoWidth}px`,I.style.height=`${u.videoHeight}px`}function O(){d.clearRect(0,0,m.width,m.height),d.save(),d.scale(-1,1),d.translate(-m.width,0),d.drawImage(u,0,0,u.videoWidth,u.videoHeight),d.restore()}async function T(){const o=faceDetection.SupportedModels.MediaPipeFaceDetector,t={runtime:"mediapipe",solutionPath:"https://cdn.jsdelivr.net/npm/@mediapipe/face_detection"};return M=await faceDetection.createDetector(o,t),new Promise(n=>{n(M)})}async function q(){const o={flipHorizontal:!1};E=await M.estimateFaces(u,o)}function w(o,t,n,e,a,s,r){const g=e.x-n.x,y=e.y-n.y,p=Math.sqrt(g*g+y*y),c=p*a,D=p*s;return A(o,t,c+v,D+j,r)}function A(o,t,n,e,a){const s=o+n*Math.cos(a)-e*Math.sin(a),r=t+n*Math.sin(a)+e*Math.cos(a);return{x:s,y:r}}function B(){!E||E.length===0||E.forEach(o=>{const{keypoints:t}=o,n=t.find(i=>i.name==="noseTip"),e=t.find(i=>i.name==="rightEye"),a=t.find(i=>i.name==="leftEye"),s=t.find(i=>i.name==="mouthCenter"),r=t.find(i=>i.name==="rightEarTragion"),g=t.find(i=>i.name==="leftEarTragion"),y=e.x-a.x,p=e.y-a.y,c=Math.atan2(p,y),x=200/Math.sqrt(Math.pow(r.x-g.x,2)+Math.pow(r.y-g.y,2));if(h==="hige"){const{x:i,y:l}=w(n.x,n.y,n,s,.15,-.5,c);b({image:f.hige,x:i,y:l,scale:4*x,angle:c})}else if(h==="rabbit"){const{x:i,y:l}=w(e.x,e.y,e,n,-.6,1,c);b({image:f.rabbit,x:i,y:l,scale:3.2*x,angle:c})}else if(h==="ribbon"){const{x:i,y:l}=w(n.x,n.y,n,s,.3,.05,c);b({image:f.ribbon,x:i,y:l,scale:3.5*x,angle:c})}else if(h==="cat02"){const{x:i,y:l}=w(e.x,e.y,e,n,-.5,.3,c);b({image:f.cat02,x:i,y:l,scale:3.5*x,angle:c})}else if(h==="cat03"){const{x:i,y:l}=w(e.x,e.y,e,n,-.5,.8,c);b({image:f.cat03,x:i,y:l,scale:3.5*x,angle:c})}else if(h==="bear01"){const{x:i,y:l}=w(e.x,e.y,e,n,-.6,.75,c);b({image:f.bear01,x:i,y:l,scale:3.5*x,angle:c})}})}function H(){L.forEach(o=>{const t=new Image;t.src=`face-detection/images/${o}.png`,f[o]=t})}function b({image:o,x:t,y:n,scale:e=1,xFix:a=0,yFix:s=0,angle:r=0}){const y=m.width-t-o.width/e/2,p=n-o.height/e/2;d.save(),d.translate(y+a+o.width/e/2,p+s+o.height/e/2),d.scale(-1,-1),d.rotate(-r),d.drawImage(o,-o.width/e/2,-o.height/e/2,o.width/e,o.height/e),d.restore()}function C(){q(),O(),B(),window.requestAnimationFrame(C)}async function S(){F(),H(),await P(),await T(),Y(),C()}S();
