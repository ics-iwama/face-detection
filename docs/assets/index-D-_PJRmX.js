(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))e(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&e(r)}).observe(document,{childList:!0,subtree:!0});function t(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function e(a){if(a.ep)return;a.ep=!0;const s=t(a);fetch(a.href,s)}})();let M,E,L=["hige","ribbon","rabbit","cat02","cat03","bear01"],f={},W=document.querySelectorAll(".button"),X=document.querySelectorAll(".position-controllerButton"),h,v=0,j=0;const u=document.getElementById("webcam"),m=document.getElementById("canvas"),I=document.getElementById("canvasWrapper"),d=m.getContext("2d");function F(){W.forEach(n=>{n.addEventListener("click",o=>{v=0,j=0,h=o.target.dataset.deco||o.target.parentElement.dataset.deco})}),X.forEach(n=>{n.addEventListener("click",o=>{const t=o.target.dataset.position||o.target.parentElement.dataset.position;t==="top"?j+=5:t==="bottom"?j-=5:t==="right"?v+=5:t==="left"&&(v-=5)})})}async function P(){const n={video:!0,width:640,height:480},o=await navigator.mediaDevices.getUserMedia(n);return u.srcObject=o,new Promise(t=>{u.onloadedmetadata=()=>{t()}})}function Y(){m.width=u.videoWidth,m.height=u.videoHeight,I.style.width=`${u.videoWidth}px`,I.style.height=`${u.videoHeight}px`}function O(){d.clearRect(0,0,m.width,m.height),d.save(),d.scale(-1,1),d.translate(-m.width,0),d.drawImage(u,0,0,u.videoWidth,u.videoHeight),d.restore()}async function T(){const n=faceDetection.SupportedModels.MediaPipeFaceDetector,o={runtime:"mediapipe",solutionPath:"https://cdn.jsdelivr.net/npm/@mediapipe/face_detection"};return M=await faceDetection.createDetector(n,o),new Promise(t=>{t(M)})}async function q(){const n={flipHorizontal:!1};E=await M.estimateFaces(u,n)}function w(n,o,t,e,a,s,r){const g=e.x-t.x,y=e.y-t.y,p=Math.sqrt(g*g+y*y),c=p*a,D=p*s;return A(n,o,c+v,D+j,r)}function A(n,o,t,e,a){const s=n+t*Math.cos(a)-e*Math.sin(a),r=o+t*Math.sin(a)+e*Math.cos(a);return{x:s,y:r}}function B(){!E||E.length===0||E.forEach(n=>{const{keypoints:o}=n,t=o.find(i=>i.name==="noseTip"),e=o.find(i=>i.name==="rightEye"),a=o.find(i=>i.name==="leftEye"),s=o.find(i=>i.name==="mouthCenter"),r=o.find(i=>i.name==="rightEarTragion"),g=o.find(i=>i.name==="leftEarTragion"),y=e.x-a.x,p=e.y-a.y,c=Math.atan2(p,y),x=200/Math.sqrt(Math.pow(r.x-g.x,2)+Math.pow(r.y-g.y,2));if(h==="hige"){const{x:i,y:l}=w(t.x,t.y,t,s,.15,-.5,c);b({image:f.hige,x:i,y:l,scale:4*x,angle:c})}else if(h==="rabbit"){const{x:i,y:l}=w(e.x,e.y,e,t,-.6,1,c);b({image:f.rabbit,x:i,y:l,scale:3.2*x,angle:c})}else if(h==="ribbon"){const{x:i,y:l}=w(t.x,t.y,t,s,.3,.05,c);b({image:f.ribbon,x:i,y:l,scale:3.5*x,angle:c})}else if(h==="cat02"){const{x:i,y:l}=w(e.x,e.y,e,t,-.5,.3,c);b({image:f.cat02,x:i,y:l,scale:3.5*x,angle:c})}else if(h==="cat03"){const{x:i,y:l}=w(e.x,e.y,e,t,-.5,.8,c);b({image:f.cat03,x:i,y:l,scale:3.5*x,angle:c})}else if(h==="bear01"){const{x:i,y:l}=w(e.x,e.y,e,t,-.6,.75,c);b({image:f.bear01,x:i,y:l,scale:3.5*x,angle:c})}})}function H(){L.forEach(n=>{const o=new Image;o.src=`face-detection/images/${n}.png`,f[n]=o})}function b({image:n,x:o,y:t,scale:e=1,xFix:a=0,yFix:s=0,angle:r=0}){const y=m.width-o-n.width/e/2,p=t-n.height/e/2;d.save(),d.translate(y+a+n.width/e/2,p+s+n.height/e/2),d.scale(-1,-1),d.rotate(-r),d.drawImage(n,-n.width/e/2,-n.height/e/2,n.width/e,n.height/e),d.restore()}function C(){q(),O(),B(),window.requestAnimationFrame(C)}async function S(){F(),H(),await P(),await T(),Y(),C()}S();
