(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();let E,j,L=["hige","ribbon","rabbit","cat02","cat03","bear01"],f={},W=document.querySelectorAll(".button"),X=document.querySelectorAll(".position-controllerButton"),h,b=0,v=0;const u=document.getElementById("webcam"),m=document.getElementById("canvas"),I=document.getElementById("canvasWrapper"),d=m.getContext("2d");function F(){W.forEach(e=>{e.addEventListener("click",t=>{b=0,v=0,h=t.target.dataset.deco||t.target.parentElement.dataset.deco})}),X.forEach(e=>{e.addEventListener("click",t=>{const n=t.target.dataset.position||t.target.parentElement.dataset.position;n==="top"?v+=5:n==="bottom"?v-=5:n==="right"?b+=5:n==="left"&&(b-=5)})})}async function P(){const e={video:!0,width:640,height:480},t=await navigator.mediaDevices.getUserMedia(e);return u.srcObject=t,new Promise(n=>{u.onloadedmetadata=()=>{n()}})}function Y(){m.width=u.videoWidth,m.height=u.videoHeight,I.style.width=`${u.videoWidth}px`,I.style.height=`${u.videoHeight}px`}function O(){d.clearRect(0,0,m.width,m.height),d.save(),d.scale(-1,1),d.translate(-m.width,0),d.drawImage(u,0,0,u.videoWidth,u.videoHeight),d.restore()}async function T(){const e=faceDetection.SupportedModels.MediaPipeFaceDetector,t={runtime:"mediapipe",solutionPath:"https://cdn.jsdelivr.net/npm/@mediapipe/face_detection"};return E=await faceDetection.createDetector(e,t),new Promise(n=>{n(E)})}async function q(){const e={flipHorizontal:!1};j=(await E.estimateFaces(u,e))[0]}function p(e,t,n,a,o,s,r){const w=a.x-n.x,g=a.y-n.y,c=Math.sqrt(w*w+g*g),M=c*o,D=c*s;return A(e,t,M+b,D+v,r)}function A(e,t,n,a,o){const s=e+n*Math.cos(o)-a*Math.sin(o),r=t+n*Math.sin(o)+a*Math.cos(o);return{x:s,y:r}}function B(){if(!j)return;const{keypoints:e}=j,t=e.find(i=>i.name==="noseTip"),n=e.find(i=>i.name==="rightEye"),a=e.find(i=>i.name==="leftEye"),o=e.find(i=>i.name==="mouthCenter"),s=e.find(i=>i.name==="rightEarTragion"),r=e.find(i=>i.name==="leftEarTragion"),w=n.x-a.x,g=n.y-a.y,c=Math.atan2(g,w),y=200/Math.sqrt(Math.pow(s.x-r.x,2)+Math.pow(s.y-r.y,2));if(h==="hige"){const{x:i,y:l}=p(t.x,t.y,t,o,.15,-.5,c);x({image:f.hige,x:i,y:l,scale:4*y,angle:c})}else if(h==="rabbit"){const{x:i,y:l}=p(n.x,n.y,n,t,-.6,1,c);x({image:f.rabbit,x:i,y:l,scale:3.2*y,angle:c})}else if(h==="ribbon"){const{x:i,y:l}=p(t.x,t.y,t,o,.3,.05,c);x({image:f.ribbon,x:i,y:l,scale:3.5*y,angle:c})}else if(h==="cat02"){const{x:i,y:l}=p(n.x,n.y,n,t,-.5,.3,c);x({image:f.cat02,x:i,y:l,scale:3.5*y,angle:c})}else if(h==="cat03"){const{x:i,y:l}=p(n.x,n.y,n,t,-.5,.8,c);x({image:f.cat03,x:i,y:l,scale:3.5*y,angle:c})}else if(h==="bear01"){const{x:i,y:l}=p(n.x,n.y,n,t,-.6,.75,c);x({image:f.bear01,x:i,y:l,scale:3.5*y,angle:c})}}function H(){L.forEach(e=>{const t=new Image;t.src=`face-detection/images/${e}.png`,f[e]=t})}function x({image:e,x:t,y:n,scale:a=1,xFix:o=0,yFix:s=0,angle:r=0}){const g=m.width-t-e.width/a/2,c=n-e.height/a/2;d.save(),d.translate(g+o+e.width/a/2,c+s+e.height/a/2),d.scale(-1,-1),d.rotate(-r),d.drawImage(e,-e.width/a/2,-e.height/a/2,e.width/a,e.height/a),d.restore()}function C(){q(),O(),B(),window.requestAnimationFrame(C)}async function S(){F(),H(),await P(),await T(),Y(),C()}S();
